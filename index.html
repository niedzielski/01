<html>
  <head>
    <meta name=viewport content='width=device-width, initial-scale=1' />
    <title>01</title>
    <style>
      body {margin: 0; background: #000; overflow: hidden;}
      canvas {
        display: block;
        width: 100%;
        height: 100%;
        image-rendering: optimizeSpeed;
        image-rendering: pixelated;
      }
    </style>
  </head>
  <body>
    <canvas></canvas>
    <script type=x-shader/x-vertex id=vert>
      uniform vec2 resolution;
      attribute vec2 vert;
      void main() {
        vec2 clip = (2. * (vert + vec2(.5, .5)) / resolution - 1.) * vec2(1, -1);
        gl_Position = vec4(clip, 0, 1);
      }
    </script>
    <script type=x-shader/x-fragment id=frag>
      precision mediump float;
      uniform vec4 color;
      void main() { gl_FragColor = color; }
    </script>
    <script>
      let gl = window.document.querySelector('canvas').getContext('webgl', {
        alpha: false,
        antialias: false,
        depth: false,
        stencil: false,
        preserveDrawingBuffer: false
      })

      let pgm = gl.createProgram()
      let loadShader = (type, id) => {
        let shader = gl.createShader(type)
        gl.shaderSource(shader, document.getElementById(id).textContent)
        gl.compileShader(shader)
        gl.attachShader(pgm, shader)
      }
      loadShader(gl.VERTEX_SHADER, 'vert')
      loadShader(gl.FRAGMENT_SHADER, 'frag')
      gl.linkProgram(pgm)
      gl.useProgram(pgm)

      let width, height = 128
      let resize = () => {
        width = Math.trunc(height * window.innerWidth / window.innerHeight)

        gl.canvas.width = width
        gl.canvas.height = height

        gl.uniform2f(gl.getUniformLocation(pgm, 'resolution'), width, height)
        gl.viewport(0, 0, width, height)
      }
      resize()
      window.addEventListener('resize', resize)


      let buffer = gl.createBuffer()
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer)
      let vert = gl.getAttribLocation(pgm, 'vert')
      gl.enableVertexAttribArray(vert)
      gl.vertexAttribPointer(vert, 2, gl.FLOAT, false, 0, 0)
      gl.uniform4f(gl.getUniformLocation(pgm, 'color'), 0, 0, 0, 1)

      let px = (x, y) => {
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([x, y]), gl.STATIC_DRAW)
        gl.drawArrays(gl.POINTS, 0, 1)
      }

      let x = 0
      let render = () => {
        gl.clearColor(.956862745, .956862745, .929411765, 1)
        gl.clear(gl.COLOR_BUFFER_BIT)

        for (let i = 0; i < height; ++i) px(x % width, i)

        ++x
        window.requestAnimationFrame(render)
      }
      render()
    </script>
  </body>
</html>
